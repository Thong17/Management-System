<!DOCTYPE html>
<html lang="en" data-theme="{% if current_user.is_authenticated %}{{ current_user.theme }}{% else %}light{% endif %}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camping Cave Management System {% block title %}{% endblock %}</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <link href="https://fonts.googleapis.com/css2?family=Hanuman&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{url_for('static', filename='css/dist/modal.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/dist/style.css')}}">

    {% block style %}{% endblock %}
</head>

<body>
    <ul class="side-nav">
        <div class="side-header">
            {% if current_user.is_authenticated %}
            <h4 class="color-text">
                {{ current_user.profile[0].company }}
            </h4>
            <p class="color-text">
                {{ current_user.profile[0].location }}
            </p>
            {% endif %}
        </div>
        <li class="side-menu">
            <span>Home</span>
            <a href="{{ url_for('route.index') }}">
                <i class="fa fa-home" aria-hidden="true"></i>
            </a>
        </li>
        {% if current_user.is_authenticated %}
        <li class="side-menu">
            <span>Sale</span>
            <a href="{{ url_for('route.financial') }}">
                <i class="fa fa-inbox" aria-hidden="true"></i>
            </a>
        </li>
        <li class="side-menu">
            <span>Customize</span>
            <a href="{{ url_for('route.custome') }}">
                <i class="fa fa-tasks" aria-hidden="true"></i>
            </a>
        </li>
        <li class="side-menu">
            <span>Reports</span>
            <a href="{{ url_for('route.financial_report') }}">
                <i class="fa fa-bar-chart" aria-hidden="true"></i>
            </a>
        </li>
        <li class="side-menu">
            <span>Configuration</span>
            <a href="/setting">
                <i class="fa fa-cog" aria-hidden="true"></i>
            </a>
        </li>
        {% endif %}
        <span class="close-sidenav hide">
            <ion-icon name="close-outline"></ion-icon>
        </span>
    </ul>
    <header>
        <nav class="menu-nav">
            <div class="nav-logo">
                <i class="fa fa-terminal logo-btn" aria-hidden="true"></i>
                <ion-icon name="menu-outline" class="sidenav-btn hide"></ion-icon>
            </div>
            {% block navbar %}{% endblock %}
            {% if current_user.is_authenticated %}
            <div class="dropdown">
                <button type="button" class="btn color-font menu-profile" data-toggle="dropdown">
                    <div class="profile-img">
                        <img src="/static/uploads/{{ current_user.profile[0].photo }}" alt="Profile">
                    </div>
                    <span>
                        {{current_user.username}}
                    </span>
                </button>
                <div class="dropdown-menu">
                    <p class="dropdown-item profile-name hide">
                        {{current_user.username}}
                    </p>
                    <a class="dropdown-item" href="/profile">Profile</a>
                    <div class="dropdown-divider"></div>
                    <form action="/logout" method="post" style="width: 100%;">
                        <input type="submit" class="btn btn-block color-text" style="border: none; width: 100%;"
                            value="Logout">
                    </form>
                </div>
            </div>
            {% else %}
            <div class="user-btn">
                <a href="/login" class="color-text mr-3">Login</a>
                <a href="/register" class="color-text btn border">Register</a>
            </div>
            {% endif %}

        </nav>
        <main>
            {% block content %}{% endblock %}
        </main>
    </header>
    <footer>
        <p class="color-text" style="font-size: 13px;">Copyright &copy; 2020 All Rights Reserved by
            <a href="#" class="notranslate">SoftDev</a>
        </p>
    </footer>
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog cascading-modal modal-avatar modal-sm" role="document">
            {% if current_user.is_authenticated %}
            <div class="modal-content">
                <div class="modal-header">

                    <img src="/static/uploads/{{ current_user.profile[0].photo }}" alt="avatar"
                        class="rounded-circle img-responsive">
                </div>
                <div class="modal-body text-center mb-1">

                    <h5 class="mb-2 color-font notranslate">{{ current_user.username }}</h5>

                    <div class="form-group" id="pwd">
                        <form id="authenticateForm" action="{{ url_for('route.authenticate') }}" style="width: 100%;">
                            <input type="hidden" value="{{ current_user.id }}">
                            <input type="password" id="userPassword" class="form-control input-color input-modal"
                                required>
                            <label for="userPassword" class="label userPassword">Password</label>
                            <input type="submit" class="hide" onclick="$('#authenticateForm').submit();">
                        </form>
                    </div>

                    <div class="text-center mt-4">
                        <button class="btn color-text btn-block btn-modal" id="loginUser">Continue</button>
                    </div>
                </div>

            </div>
            {% endif %}
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.0/js/mdb.min.js">
    </script>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/gsap-latest-beta.min.js"></script>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/CSSRulePlugin3.min.js"></script>

    <script src="https://unpkg.com/ionicons@5.1.0/dist/ionicons.js"></script>
    <script src="{{url_for('static', filename='js/translate.js')}}"></script>
    <script src="{{url_for('static', filename='js/accounting.js')}}"></script>
    <script src="{{url_for('static', filename='js/script.js')}}"></script>
    <script>
        $(document).ready(function () {
            $('.menu-bar').on('click', 'a', function () {
                if ($(this).attr('class').trim() == 'cashing') {
                    event.preventDefault()
                    $('#loginModal').modal('show')
                }
            })

            if ("onhashchange" in window) {
                var url = window.location.pathname.split('/')[1]
            }

            $('#loginUser').on('click', function () {
                $('#authenticateForm').submit()
            })

            $('#authenticateForm').on('submit', function () {
                event.preventDefault()
                var password = $('#userPassword').val()
                $.ajax({
                    url: '/authenticate',
                    type: 'POST',
                    data: { password: password },
                    success: function (data) {
                        if (data.redirect != '') {
                            window.location.href = data.redirect
                        } else {
                            if (data.password != '') {
                                const element = data.password;
                                $('#userPassword').addClass('invalid')
                                $('#userPassword').focus()
                                $('#pwd').append('<div title="' + element + '" class="errors-msg" id="err-pwd"><i class="fa fa-exclamation" aria-hidden="true"></i></div>')

                                gsap.from('#err-pwd', {
                                    opacity: 0,
                                    scale: 0.5,
                                    duration: 1,
                                    ease: 'elastic.out'
                                })
                            } else {
                                $('.userPassword').removeClass('invalid')
                                $('#err-pwd').remove()
                            }
                        }
                    }
                })
                return false
            })

            $('.side-menu').hover(
                function () {
                    $(this).addClass('active')
                },
                function () {
                    $(this).removeClass('active')
                }
            )

            $('.side-menu').on('click', function () {
                var li = $(this)
                li.removeClass('active')
                setTimeout(function () {
                    li.find('a')[0].click()
                }, 300)
            })

            function currencyFormat(currency, decimal, isAttribute) {
                if (currency == '') {
                    currency = '$'
                }
                if (decimal == '') {
                    decimal = 2
                }
                if (isAttribute == '') {
                    isAttribute = false
                }
                var numbers = document.querySelectorAll('.currency-format')
                Array.from(numbers).forEach(n => {
                    var text = $(n).text()
                    var title = $(n).attr('title')
                    $(n).text(accounting.formatMoney(text, currency, decimal))
                    if (isAttribute) {
                        $(n).attr('title', accounting.formatMoney(title, '\u17DB', 0))
                    }
                })
            }



            var menus = document.querySelectorAll('.menu-bar li')
            if (menus.length > 0) {
                var url = window.location.pathname.split('/')[1]
                Array.from(menus).forEach(menu => {
                    $(menu).removeClass('active')
                    if ($(menu).attr('class').split('-')[1] == url) {
                        $(menu).addClass('active')
                    }
                })
            }

            var theme = $('html').attr('data-theme')

            $.each($('#select-theme option'), function () {
                if ($(this).val() == theme) {
                    $(this).attr('selected', 'selected')
                }
            })
            $('#side-btn').on('click', function () {
                $('.side-nav').toggleClass('nav-on')
            })
            $('#select-theme').on('change', function () {
                theme = $(this).children('option:selected').val()
                $.ajax({
                    url: '/theme/change',
                    method: 'POST',
                    data: {
                        data: theme
                    },
                    success: function (data) {
                        $('html').attr('data-theme', data['theme'])
                    }
                })
            })



            $(document).on('click', '.add-value', function () {
                var property = $(this).attr('id')
                var title = $(this).prev().text()
                $('.modal-title').text(title)
                $('.modal-body').html(valueForm('', '0.00', '', ''))
                toggleEdit($('.save-btn'), $('.edit-btn'))
                $('.save-btn').attr('id', property)
            })

            $('.save-btn').on('click', function () {
                event.stopPropagation()
                var product = $('.details-title').attr('id')
                var property = $(this).attr('id')

                var value = $('#property-name').val()
                var price = $('#property-price').val()
                var currency = $('#property-currency').val()
                var description = $('#property-description').val()

                if (value == '') {
                    $('#property-name').focus()
                } else {
                    $.ajax({
                        url: '/value/add',
                        method: 'POST',
                        data: {
                            product: product,
                            property: property,
                            value: value,
                            price: price,
                            currency: currency,
                            description: description
                        },
                        success: function (data) {
                            $('#addValue').modal('hide')
                            if (data.currency == 'riel') {
                                data.currency = 'R'
                            } else {
                                data.currency = '$'
                            }
                            var element = `<label class="value container-input" id="` + data.id + `">
                                        <div class="product-btn color-text">
                                            <i class="fa fa-pencil-square-o edit-value" aria-hidden="true"></i>
                                            <i class="fa fa-trash-o delete-value" aria-hidden="true"></i>
                                        </div>
                                        <div class="flex-between-start">
                                            <div class="flex-column-start-start">
                                                <h5 class="color-font" id="value-value">` + data.value +
                                `</h5>
                                                <p style="font-size: 11px" class="color-text" id="value-description">` + data.description + `</p>
                                            </div>
                                        </div>
                                        <div class="flex-end color-text" style="font-size: 18px">
                                            <p class="color-text" id="value-currency">` + data.currency + `</p>
                                            <p class="color-text" id="value-price">` + data.price + `</p>
                                        </div>
                                        <input type="radio" name="` + data.property + `">
                                        <span class="checkbox"></span></label>`

                            var values = $('.property-' + data.property)
                            values.append(element)
                        }
                    })
                }
            })
            $(document).on('click', '.btn-value', function () {
                $(this).parent().prev().find('.add-value').click()
            })

            $('.sidenav-btn').on('click', function () {
                $('.side-nav').addClass('active')
            })

            $('.close-sidenav').on('click', function () {
                $('.side-nav').removeClass('active')
            })
        })
    </script>
    {% block script %} {% endblock %}
</body>

</html>