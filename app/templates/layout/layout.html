<!DOCTYPE html>
<html data-lang="{% if current_user.is_authenticated %}{{ current_user.language }}{% else %}english{% endif %}"
    data-theme="{% if current_user.is_authenticated %}{{ current_user.theme }}{% else %}light{% endif %}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management System {% block title %}{% endblock %}</title>
    <link rel="icon" href="{{url_for('static', filename='svg/icon.png')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap.min.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/font-awesome.min.css')}}">
    <link href="https://fonts.googleapis.com/css2?family=Hanuman&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{url_for('static', filename='css/dist/modal.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/dist/style.css')}}">
    <style>
        .alert {
            position: absolute;
            width: calc(100% - 6rem);
            z-index: 10;
        }

        .alert-warning {
            background-color: #fff3cdee;
        }
    </style>

    {% block style %}{% endblock %}
</head>

<body>
    {% if current_user.is_authenticated and current_user.isConfirm %}
    <ul class="side-nav">
        <div class="side-header">
            {% if current_user.is_authenticated %}
            <h4 class="color-text">
                {{ current_user.profile[0].company }}
            </h4>
            <p class="color-text">
                {{ current_user.profile[0].location }}
            </p>
            {% endif %}
        </div>
        <li class="side-menu" id="home">
            <span>Home</span>
            <a href="{{ url_for('route.index') }}">
                <i class="fa fa-home" aria-hidden="true"></i>
            </a>
        </li>
        <li class="side-menu" id="financial">
            <span>Financial</span>
            <a href="{{ url_for('route.financial') }}">
                <i class="fa fa-usd" aria-hidden="true"></i>
            </a>
        </li>
        <li class="side-menu" id="customize">
            <span>Modify</span>
            <a href="{{ url_for('route.custome') }}">
                <i class="fa fa-sliders" aria-hidden="true"></i>
            </a>
        </li>
        <li class="side-menu" id="reports">
            <span>Reports</span>
            <a href="{{ url_for('route.financial_report') }}">
                <i class="fa fa-bar-chart" aria-hidden="true"></i>
            </a>
        </li>
        <li class="side-menu" id="configuration">
            <span>Setting</span>
            <a href="/setting">
                <i class="fa fa-cog" aria-hidden="true"></i>
            </a>
        </li>
        <span class="close-sidenav hide color-text">
            <ion-icon name="close-outline"></ion-icon>
        </span>
    </ul>
    {% else %}
    {% endif %}
    
    <header class="{% if current_user.is_authenticated and current_user.isConfirm %}isAuthenticated{% endif %}">
        <nav class="menu-nav {% if current_user.is_authenticated and current_user.isConfirm %}isAuthenticated{% endif %}">
            <div class="nav-logo">
                <i class="fa fa-terminal logo-btn" aria-hidden="true"></i>
                <ion-icon name="menu-outline" class="sidenav-btn hide"></ion-icon>
            </div>
            {% block navbar %}{% endblock %}
            {% if current_user.is_authenticated %}
            <div class="dropdown">
                <button type="button" class="btn color-font menu-profile" data-toggle="dropdown">
                    <div class="profile-img">
                        <img src="/static/uploads/{{ current_user.profile[0].photo }}" alt="Profile">
                    </div>
                    <span class="notranslate">
                        {{current_user.username}}
                    </span>
                </button>
                <div class="dropdown-menu">
                    <p class="dropdown-item profile-name hide notranslate">
                        {{current_user.username}}
                    </p>
                    <a class="dropdown-item" href="/profile">Profile</a>
                    <div class="dropdown-divider"></div>
                    <form action="/logout" method="post" style="width: 100%;">
                        <input type="submit" class="btn btn-block color-text" style="border: none; width: 100%;"
                            value="Logout">
                    </form>
                </div>
            </div>
            {% else %}
            <div class="user-btn">
                <a href="/login" class="color-text mr-3">Login</a>
                <a href="/register" class="color-text btn border">Register</a>
            </div>
            {% endif %}
        </nav>
        <main>
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="mx-5 alert alert-{{ messages.0.0 }} alert-dismissible fade show" role="alert">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                {% for category, message in messages %}
                {{ message }} </br>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}
            {% block content %}{% endblock %}
            <div class="loading-container">
            {% if loading %}
                {% for c in loading %}
                    {% if c == ' ' %}
                    <span>-</span>
                    {% else %}
                    <span>{{ c }}</span>
                    {% endif %}
                {% endfor %}
            {% endif %}
            </div>
        </main>
    </header>
    <footer>
        <p class="color-text" style="font-size: 13px;">Copyright &copy; 2020 All Rights Reserved by
            <a href="#" class="notranslate">Soft Dev</a>
        </p>
    </footer>

    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog cascading-modal modal-avatar modal-sm" role="document">
            {% if current_user.is_authenticated %}
            <div class="modal-content">
                <div class="modal-header">

                    <img src="/static/uploads/{{ current_user.profile[0].photo }}" alt="avatar"
                        class="rounded-circle img-responsive">
                </div>
                <div class="modal-body text-center mb-1">

                    <h5 class="mb-2 color-font notranslate">{{ current_user.username }}</h5>

                    <div class="form-group" id="pwd">
                        <form id="authenticateForm" action="{{ url_for('route.authenticate') }}" style="width: 100%;">
                            <input type="hidden" value="{{ current_user.id }}">
                            <input type="password" id="userPassword" class="form-control input-color input-modal"
                                required>
                            <label for="userPassword" class="label userPassword">Password</label>
                            <input type="submit" class="hide" onclick="$('#authenticateForm').submit();">
                        </form>
                    </div>

                    <div class="text-center mt-4">
                        <button class="btn color-text btn-block btn-modal" id="loginUser">Continue</button>
                    </div>
                </div>

            </div>
            {% endif %}
        </div>
    </div>

    <script src="{{url_for('static', filename='js/jquery.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/popper.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/bootstrap.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/mdb.min.js')}}"></script>
    <script type="module" src="{{url_for('static', filename='ionicons/ionicons.esm.js')}}"></script>
    <script nomodule src="{{url_for('static', filename='ionicons/ionicons.js')}}"></script>
    <script src="{{url_for('static', filename='js/gsap-latest-beta.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/CSSRulePlugin3.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/translate.js')}}"></script>
    <script src="{{url_for('static', filename='js/accounting.js')}}"></script>
    <script src="{{url_for('static', filename='js/script.js')}}"></script>
    <script src="{{url_for('static', filename='js/translator.js')}}"></script>
    <script>
        $(document).translator()

        var i = 0;
        $(window).on('scroll', function () {
            $('nav').toggleClass('navbar-hide', $(window).scrollTop() > i)
            i = $(window).scrollTop()
        })

        $('.menu-bar').on('click', 'a', function () {
            if ($(this).attr('class').trim() == 'cashing') {
                event.preventDefault()
                $('#loginModal').modal('show')
            }
        })

        if ("onhashchange" in window) {
            var url = window.location.pathname.split('/')[1]
        }

        $('#loginUser').on('click', function () {
            $('#authenticateForm').submit()
        })

        $('#authenticateForm').on('submit', function () {
            event.preventDefault()
            var password = $('#userPassword').val()
            $.ajax({
                url: '/authenticate',
                type: 'POST',
                data: { password: password },
                success: function (data) {
                    if (data.redirect != '') {
                        window.location.href = data.redirect
                    } else {
                        if (data.password != '') {
                            const element = data.password;
                            $('#userPassword').addClass('invalid')
                            $('#userPassword').focus()
                            $('#pwd').append('<div title="' + element + '" class="errors-msg" id="err-pwd"><i class="fa fa-exclamation" aria-hidden="true"></i></div>')

                            gsap.from('#err-pwd', {
                                opacity: 0,
                                scale: 0.5,
                                duration: 1,
                                ease: 'elastic.out'
                            })
                        } else {
                            $('.userPassword').removeClass('invalid')
                            $('#err-pwd').remove()
                        }
                    }
                }
            })
            return false
        })

        $('.side-menu').hover(
            function () {
                $(this).addClass('active')
            },
            function () {
                $(this).removeClass('active')
            }
        )

        $('.side-menu').on('click', function () {
            var li = $(this)
            li.removeClass('active')
            li.find('a')[0].click()
        })

        function currencyFormat(decimal, isAttribute) {
            if (decimal == undefined) {
                decimal = 3
            }
            var numbers = document.querySelectorAll('.currency-format')
            Array.from(numbers).forEach(n => {
                var text = $(n).text()
                if ($(n).attr('data-currency') == 'KHR') {
                    $(n).attr('title', accounting.formatMoney(text / 4000, {precision: decimal, format: {pos: "%v%s", neg: "-%v%s", zero: '%v%s'}}))
                    $(n).text(accounting.formatMoney(Math.round(text / 100) * 100, {
                        precision: 0,
                        format: {
                            pos: "%v\u17DB",
                            neg: "-%v\u17DB",
                            zero: '...'
                        }
                    }))
                }
                else {
                    $(n).text(accounting.formatMoney(text, {precision: decimal, format: {pos: "%v%s", neg: "-%v%s", zero: '%v%s'}}))
                    $(n).attr('title', accounting.formatMoney(Math.round(text * 4000 / 100) * 100, {
                        precision: 0,
                        format: {
                            pos: "%v\u17DB",
                            neg: "-%v\u17DB",
                            zero: '...'
                        }
                    }))
                }
            })
        }

        function currencyUSD(precision) {
            var numbers = document.querySelectorAll('.currency-usd')
            Array.from(numbers).forEach(n => {
                var text = $(n).text()
                $(n).text(accounting.formatMoney(text, {
                                                    precision: precision,
                                                    format: {
                                                        pos: "%v%s",
                                                        neg: "-%v%s",
                                                        zero: '...'
                                                    }
                                                }))
                
            })
        }

        function _Chart(div, canvas, type, data, prefix, suffix) {
            this.div = div
            this.canvas = canvas
            this.type = type
            this.data = data

            var canvas = this.canvas

            canvas.width = this.div.offsetWidth
            canvas.height = this.div.offsetHeight

            $(window).on('resize', function () {
                canvas.width = this.div.offsetWidth
                canvas.height = this.div.offsetHeight
            })
            var bgColor = $('.grid-item').css('background-color')
            var fontColor = $('.color-font').css('color')

            var ctxP = canvas.getContext('2d');
            var myPieChart = new Chart(ctxP, {
                type: this.type,
                data: {
                    labels: this.data.labels,
                    datasets: [{
                        data: this.data.quantities,
                        backgroundColor: this.data.colors
                    }]
                },
                options: {
                    responsive: true,
                    elements: {
                        arc: {
                            borderColor: bgColor
                        }
                    },
                    legend: {
                        display: true,
                        labels: {
                            fontColor: fontColor,
                            padding: 30
                        },
                        position: 'left'
                    },
                    tooltips: {
                        enabled: true,
                        mode: 'single',
                        callbacks: {
                            label: function (tooltipItems, data) {
                                this.suffix = suffix
                                this.prefix = prefix
                                return data.labels[tooltipItems.index] + ' ' + this.prefix + data.datasets[0].data[tooltipItems.index] + this.suffix;
                            }
                        }
                    }
                },
                plugins: {        
                    zoom: {
                        pan: {
                            enabled: true
                        },
                        zoom: {
                            enabled: true
                        }
                    }
                }
            });
        }

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        function dateDifference(date) {
            now = new Date()
            this.date = new Date(date)
            diff = (this.date - now) / (1000 * 3600 * 24)
            return diff
        }

        function generateColor() {
            var letters = '456789AB';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 8)];
            }
            return color;
        }

        function hexToRgbA(hex) {
            var c;
            if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {
                c = hex.substring(1).split('');
                if (c.length == 3) {
                    c = [c[0], c[0], c[1], c[1], c[2], c[2]];
                }
                c = '0x' + c.join('');
                return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ',0.5)';
            }
            throw new Error('Bad Hex');
        }

        var menus = document.querySelectorAll('.menu-bar li')
        if (menus.length > 0) {
            var url = window.location.pathname.split('/')[1]
            Array.from(menus).forEach(menu => {
                $(menu).removeClass('active')
                if ($(menu).attr('class').split('-')[1] == url) {
                    $(menu).addClass('active')
                }
            })
        }

        var sidemenus = document.querySelectorAll('.side-menu')
        Array.from(sidemenus).forEach(m => {
            $(m).removeClass('current')
        })
        menuArr = [
            {
                route: 'home',
                sub: ['home', 'about', 'contact']
            },
            {
                route: 'financial',
                sub: ['cashing', 'order', 'stock', 'expense', 'transaction', 'financial', 'payments', 'owe']
            },
            {
                route: 'customize',
                sub: ['category', 'brand', 'store', 'admin', 'role', 'advertise', 'custome']
            },
            {
                route: 'reports',
                sub: ['financial_report', 'sale_report', 'account', 'activity', 'report']
            },
            {
                route: 'configuration',
                sub: ['setting']
            },
        ]

        url = window.location.pathname.split('/')[1]
        menuArr.forEach(m => {
            if (m.sub.includes(url)) {
                $('#' + m.route).addClass('current')
            }
        })

        var theme = $('html').attr('data-theme')

        $.each($('#select-theme option'), function () {
            if ($(this).val() == theme) {
                $(this).attr('selected', 'selected')
            }
        })
        $('#side-btn').on('click', function () {
            $('.side-nav').toggleClass('nav-on')
        })
        $('#select-theme').on('change', function () {
            theme = $(this).children('option:selected').val()
            $.ajax({
                url: '/theme/change',
                method: 'POST',
                data: {
                    data: theme
                },
                success: function (data) {
                    $('html').attr('data-theme', data['theme'])
                    $('.nav-logo img').attr('src', '/static/icons/favicon-' + data['theme'] + '.svg')
                }
            })
        })

        function searchProducts(input, list, filter) {
            this.input = input.toUpperCase();
            this.list = list
            this.filter = filter

            Array.from(this.list).forEach((l, i) => {
                var value = $(l).find(this.filter).text().toUpperCase()
                if (value.indexOf(this.input) > -1) {
                    $(l).css('display', 'block')
                } else {
                    $(l).css('display', 'none')
                }
            })
        }

        function favoriteProducts(input, list, filter) {
            this.input = input.toUpperCase();
            this.list = list
            this.filter = filter

            Array.from(this.list).forEach((l, i) => {
                var value = $(l).find(this.filter).text().toUpperCase()
                if ($(l).find(this.filter).hasClass('active')) {
                    $(l).css('display', 'block')
                } else {
                    $(l).css('display', 'none')
                }
            })
        }

        function sortElement(property, order) {
            var sortOrder = 1;
            if (property[0] === "-") {
                sortOrder = -1;
                property = property.substr(1);
            }

            return function (a, b) {
                var t_first = $(a).find(property).text()
                var t_second = $(b).find(property).text()
                var first = accounting.unformat($(a).find(property).text())
                var second = accounting.unformat($(b).find(property).text())
                var f_date = new Date($(a).find(property).text())
                var s_date = new Date($(b).find(property).text())
                switch (order) {
                    case 'price-desc':
                        var result = (parseFloat(first) > parseFloat(second)) ? -1 : (parseFloat(first) < parseFloat(second)) ? 1 : 0;
                        break;
                    case 'price-asc':
                        var result = (parseFloat(first) < parseFloat(second)) ? -1 : (parseFloat(first) > parseFloat(second)) ? 1 : 0;
                        break
                    case 'title-asc':
                        var result = (t_first < t_second) ? -1 : (t_first > t_second) ? 1 : 0;
                        break
                    case 'date-asc':
                        var result = (f_date > s_date) ? -1 : (f_date < s_date) ? 1 : 0;
                        break
                    case 'date-desc':
                        var result = (f_date < s_date) ? -1 : (f_date > s_date) ? 1 : 0;
                        break
                }
                return result * sortOrder;
            }
        }

        function filterProduct(list, property, order) {
            list.sort(sortElement(property, order))
        }

        function selectMenu(list, menu, type, input) {
            this.menu = menu
            this.list = list
            this.type = type
            this.input = input.toUpperCase();

            var menus = []
            var types = []
            var result = []
            var temp = []

            Array.from(this.menu).forEach(m => {
                if ($(m).hasClass('active')) {
                    menus.push($(m).attr('id'))
                }
            })

            Array.from(this.type).forEach(t => {
                if ($(t).hasClass('active')) {
                    types.push($(t).attr('id'))
                }
            })

            if (menus.length > 0) {
                Array.from(this.list).forEach(l => {
                    if (menus.indexOf($(l).find('#details-brand').val()) !== -1) {
                        if (types.length > 0) {
                            if (types.indexOf($(l).find('#details-categ').val()) !== -1) {
                                var value = $(l).find('#details-title').text().toUpperCase()
                                if (value.indexOf(this.input) > -1) {
                                    $(l).css('display', 'block')
                                }
                                temp.push(l)
                            } else {
                                $(l).css('display', 'none')
                            }
                        } else {
                            var value = $(l).find('#details-title').text().toUpperCase()
                            if (value.indexOf(this.input) > -1) {
                                $(l).css('display', 'block')
                            }
                            temp.push(l)
                        }
                    } else {
                        $(l).css('display', 'none')
                    }
                })
            } else if (types.length > 0) {
                Array.from(this.list).forEach(l => {
                    if (types.indexOf($(l).find('#details-categ').val()) !== -1) {
                        if (menus.length > 0) {
                            if (menus.indexOf($(l).find('#details-brand').val()) !== -1) {
                                var value = $(l).find('#details-title').text().toUpperCase()
                                if (value.indexOf(this.input) > -1) {
                                    $(l).css('display', 'block')
                                }
                                temp.push(l)
                            } else {
                                $(l).css('display', 'none')
                            }
                        } else {
                            var value = $(l).find('#details-title').text().toUpperCase()
                            if (value.indexOf(this.input) > -1) {
                                $(l).css('display', 'block')
                            }
                            temp.push(l)
                        }
                    } else {
                        $(l).css('display', 'none')
                    }
                })
            }
            else {
                Array.from(this.list).forEach(l => {
                    var value = $(l).find('#details-title').text().toUpperCase()
                    if (value.indexOf(this.input) > -1) {
                        $(l).css('display', 'block')
                    }
                    temp.push(l)
                })
            }
            return temp
        }

        function accountMoney(amount) {
            precision = 0
            if (amount % 1 != 0) {
                precision = 3
            }
            return accounting.formatMoney(amount, {precision: precision, format: {pos: "%v", neg: "%v", zero: '%v'}})
        }

        function amountList(id, money, currency, unit) {
            return `<tr id="`+id+`">
                        <td class="pre-money">`+accountMoney(money)+`</td>
                        <td class="pre-currency" style="text-align:center;">`+currency+`</td>
                        <td class="pre-unit" style="text-align:center;">`+unit+`</td>
                        <td class="pre-total" style="text-align:center;">`+accountMoney(money * unit)+`</td>
                        <td class="color-text flex-between-center clear-btn"><ion-icon name="close-outline"></ion-icon></td>
                    </tr>`
        }

        function accountUSD(amount) {
            return accounting.formatMoney(amount, {precision: 3, format: {pos: "%v%s", neg: "-%v%s", zero: '...'}})
        }

        function accountKHR(amount) {
            return accounting.formatMoney(Math.round(amount / 100) * 100, {
                        precision: 0,
                        format: {
                            pos: "%v\u17DB",
                            neg: "-%v\u17DB",
                            zero: '...'
                        }
                    })
        }

        function valueForm(name, price, details, currency) {
            this.name = name
            this.price = price
            this.details = details
            this.currency = currency

            if (this.currency == 'KHR') {
                var element = '<option value="USD">$</option><option value="KHR" selected="seleceted"><span>\u17DB</span></option>'
            } else {
                var element = '<option value="USD" selected="seleceted">$</option><option value="KHR"><span>\u17DB</span></option>'
            }

            return `<div class="form-group">
                    <input class="form-control input-color" type="text" name="property-name" id="property-name" value="` +
                this.name +
                `">
                    <label class="label name" for="property-name">Name</label>
                </div>
                <div class="row">
                    <div class="col-md-8 pr-0">
                        <div class="form-group">
                            <input class="form-control input-color" step="any" type="number" name="property-price" id="property-price" value="` +
                accounting.unformat(this.price) + `">
                            <label class="label price" for="property-price">Price</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <select class="form-control input-color" id="property-currency" name="property-currency">
                                ` + element + `
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group pb-3">
                    <textarea class="form-control input-color" type="text" id="property-description" name="property-description" style="min-height: 100px;">` +
                this.details + `</textarea>
                    <label class="label description" for="property-description">Description</label>
                </div>`
        }

        function uploadColor(picker, input) {
            $('.pcr-app').each((i, obj) => {
                if ($(obj).attr('id') == 'pickr-add') {
                    $(obj).remove()
                }
            })
            this.picker = picker
            this.input = input
            const pickr = Pickr.create({
                el: this.picker,
                theme: 'classic', // or 'monolith', or 'nano'
                defaultRepresentation: 'HEX',
                default: '#111111',
                useAsButton: true,
                components: {
                    // Main components
                    preview: true,
                    opacity: true,
                    hue: true,

                    // Input / output Options
                    interaction: {
                        hex: false,
                        rgba: false,
                        hsla: false,
                        hsva: false,
                        cmyk: false,
                        input: true,
                        clear: false,
                        save: true
                    }
                }
            })
            $('.pcr-app').each((i, obj) => {
                if ($(obj).attr('id') != 'pickr-edit') {
                    $(obj).attr('id', 'pickr-add')
                    $(obj).find('.pcr-interaction').attr('id', 'pcr-add-btn')
                }
            })

            $('#pcr-add-btn').prepend('<input value="" type="text" class="pcr-name" id="' + this.input +
                '" placeholder="Name" style="width: 50%; text-align: left">')


            pickr.on('save', (color, instance) => {
                $('.pcr-save').attr('disabled', true)
                const hex = color.toHEXA().toString()
                const name = $('#' + this.input).val()
                const id = $(this.picker).attr('id')
                if (name != '') {
                    $.ajax({
                        url: '/product/color/' + id,
                        type: 'post',
                        data: {
                            'hex': hex,
                            'color': name
                        },
                        beforeSend: function () {

                        },
                        success: function (data) {
                            $('#color').append(`<option value="` + data.hex + `" id="` + data.id +
                                `">` + data.color + `</option>`)
                            $('.pcr-save').attr('disabled', false)
                            $('.details-colors').append(`<div class="span-border"><span class="span-color" id="` + data
                                .id + `" style="background-color: ` + data.hex + `"></span></div>`)
                            $('.pcr-name').val('')
                            pickr.hide()
                        }
                    })
                } else {
                    $('#' + this.input).focus()
                    $('.pcr-save').attr('disabled', false)
                }
            })
        }

        function toggleEdit(show, hide) {
            this.show = show
            this.hide = hide

            this.show.removeClass('hide')
            this.hide.addClass('hide')
        }

        function toggleLoader(loader) {
            this.loader = loader
            if (this.loader.hasClass('hide')) {
                this.loader.removeClass('hide')
            } else {
                this.loader.addClass('hide')
            }
        }

        function toggleActive(element) {
            this.element = element
            if (this.element.hasClass('active')) {
                this.element.removeClass('active')
            } else {
                this.element.addClass('active').focus()
            }
        }

        function dynamicSort(property) {
            var sortOrder = 1;
            if (property[0] === "-") {
                sortOrder = -1;
                property = property.substr(1);
            }
            return function (a, b) {
                var result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;
                return result * sortOrder;
            }
        }

        function showProduct(element, id, product, category, photo, price, currency, arrival, discount) {
            this.element = element
            this.id = id
            this.product = product
            this.photo = photo
            this.price = price
            this.currency = currency
            this.category = category
            this.arrival = arrival
            this.discount = discount
            var duration = ''
            var disc = ''

            if (this.currency == 'KHR') {
                price = accountKHR(this.price)
            } else {
                price = accountUSD(this.price)
            }

            if (this.arrival < 1) {
                duration = '<img src="static/svg/new-{{current_user.theme}}.svg" alt="" srcset="">'
            }
            if (this.discount != '') {
                disc = this.discount + '%'
            }
            this.element.append(`
                    <div class="product-item" id="` + this.id + `">
                        <div class="item-wrapper">
                            <div class="item-img">
                                <img src="static/uploads/` + this.photo + `" alt="" srcset="">
                                <div class="product-btn color-text">
                                    <i class="fa fa-pencil-square-o edit-product" aria-hidden="true"></i>
                                    <i class="fa fa-trash-o delete-product" aria-hidden="true"></i>
                                </div>
                                <div class="product-arrival">
                                    `+ duration + `
                                </div>
                            </div>
                            <div class="item-details">
                                <div class="details">
                                    <p class="notranslate color-font text-wrapper" id="details-title" style="font-size: 14px;" title="` +
                this.product + `">` +
                this.product + `</p>
                                    <p class="color-text notranslate" id="details-category" style="font-size: 12px;">` + this
                    .category +
                `</p>
                                </div>
                                <div class="notranslate flex-between-end color-text" style="width: 100%;">
                                    <p class="color-font text-wrapper" id="details-price" style="font-size: 14px; width: 100px;"><span class="symbol"></span><span class="price-tag">` +
                price + `</span></p>
                                    <p style="font-size: 12px;">
                                       
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>`)
        }

        function convertUTCDateToLocalDate(date) {
            return new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds()));
        }


        function showProductDetails(params) {
            var image = params.image
            var colors = params.colors
            var product = params.product
            var category = params.category
            var description = params.description
            var currency = params.currency
            var price = params.price
            var properties = params.properties
            var editable = params.editable
            var values = params.values
            var width = params.width
            var height = params.height
            var weight = params.weight
            var depth = params.depth
            var material = params.material
            var id = params.id
            var brand = params.brand

            var add_property = '<button class="btn border btn-value color-font"><p class="plus">+</p></button>'
            var product_btn = `<div class="product-btn color-text">
                                    <i class="fa fa-pencil-square-o edit-value" aria-hidden="true"></i>
                                    <i class="fa fa-trash-o delete-value" aria-hidden="true"></i>
                                </div>`

            if (editable == false) {
                add_property = ''
                product_btn = ''
            }

            var color_element = ''

            if (colors.length > 0) {
                colors.forEach(color => {
                    color_element += '<div class="span-border"><span class="span-color" id="' + color.id + '" style="background-color: ' + color.hex + '" title="' + color.color + '"></span></div>'
                });
            }

            if (currency == 'KHR') {
                currency = '\u17DB'
                precisionProduct = 0
            } else {
                currency = '$'
                precisionProduct = 3
            }

            var property_element = ''

            if (properties.length > 0) {
                properties.forEach(property => {
                    var value_element = add_property

                    if (values.length > 0) {
                        values.forEach(value => {
                            if (value.currency == 'KHR') {
                                currencyValue = '\u17DB'
                                precision = 0
                            } else {
                                currencyValue = '$'
                                precision = 3
                            }
                            if (value.property == property.id) {
                                value_element += `<label class="value container-input" id="` + value.id + `">
                                                    `+ product_btn + `
                                                    <div class="flex-between-start">
                                                        <div class="flex-column-start-start">
                                                            <h5 class="color-font notranslate" id="value-value">` + value.value + `</h5>
                                                            <p class="color-text hide" id="value-currency">` + value.currency + `</p>
                                                            <p style="font-size: 11px" class="color-text" id="value-description">` + value.description + `</p>
                                                        </div>
                                                    </div>
                                                    <div class="flex-end" style="font-size: 18px">
                                                        <p class="color-text notranslate" id="value-price">` + accounting.formatMoney(value.priceCurrency, {
                                                                                                                                        precision: precision,
                                                                                                                                        format: {
                                                                                                                                            pos: "%v"+currencyValue,
                                                                                                                                            neg: "%v"+currencyValue,
                                                                                                                                            zero: '...'
                                                                                                                                        }
                                                                                                                                    }) + `</p>
                                                    </div>
                                                    <input type="radio" class="input-radio" name="` + property.id + `">
                                                    <span class="checkbox"></span>
                                                </label>`
                            }

                        });
                    }
                    property_element +=
                        `<div class="flex-column-start-start mt-4">
                            <h5 class="color-font mb-3"><i class="fa fa-caret-right right" aria-hidden="true"></i>` +
                        property.property + `</h5>
                            <button class="hide btn border color-font btn-slim add-value" id="` +
                        property.id + `" data-toggle="modal" data-target="#addValue"><p class="plus">+</p></button>
                        </div>
                        <div class="property-values property-` + property.id + `">
                            ` + value_element + `
                        </div>`
                });
            }

            return `<div class="product-details">
                        <div class="details-left">
                            <div class="details-img">
                                <a href="` + image + `" data-lightbox="product-img" alt="" srcset="">
                                    <img src="` + image + `">    
                                </a>
                            </div>
                            <div class="details-colors">` + color_element +
                `</div>
                            <div class="details-appearance">
                                <h5 class="color-font mt-3 mb-2"><i class="fa fa-caret-right right" aria-hidden="true"></i><span class="ln-details"></span></h5>
                                <div class="config-list flex-between pt-2">
                                    <p class="property-name color-text ln-width" style="font-size: 13px">Width:</p><span class="color-font appearance-value">`+ width + `</span>
                                </div>
                                <div class="config-list flex-between py-1">
                                    <p class="property-name color-text ln-height" style="font-size: 13px">Height:</p><span class="color-font appearance-value">`+ height + `</span>
                                </div>
                                <div class="config-list flex-between py-1">
                                    <p class="property-name color-text ln-weight" style="font-size: 13px">Weight:</p><span class="color-font appearance-value">`+ weight + `</span>
                                </div>
                                <div class="config-list flex-between py-1">
                                    <p class="property-name color-text ln-depth" style="font-size: 13px">Depth:</p><span class="color-font appearance-value">`+ depth + `</span>
                                </div>
                                <div class="config-list flex-between py-1">
                                    <p class="property-name color-text ln-material" style="font-size: 13px">Material:</p><span class="color-font appearance-value">`+ material + `</span>
                                </div>
                                <div class="config-list flex-between py-1">
                                    <p class="property-name color-text ln-brand" style="font-size: 13px">Brand:</p><span class="color-font appearance-value">`+ brand + `</span>
                                </div>
                            </div>
                        </div>
                        <div class="details-right">
                            <div class="details-details">
                                <div class="details">
                                    <p class="notranslate color-font text-wrapper details-title" id="` + id +
                `" style="font-size: 23px;">` + product + `</p>
                                    <div class="flex-start">
                                        <p class="notranslate color-text" id="details-category" style="font-size: 12px;">` + category + `</p>
                                        <div class="flex-start ml-1 description-container" style="width: 80%">
                                            <span class="caret-right"></span>
                                            <p class="color-text text-wrapper" id="details-description" style="font-size: 12px; text-align: left;">` + description + `<p>
                                        </div>
                                    </div>
                                </div>
                                <div class="details-header" style="font-size: 23px">
                                    <span class="notranslate details-price color-font">` + accounting.formatMoney(price, {
                                                    precision: precisionProduct,
                                                    format: {
                                                        pos: "%v",
                                                        neg: "%v",
                                                        zero: '...'
                                                    }
                                                }) + `</span>
                                    <span class="color-text details-currency">`+currency+`</span>
                                </div>
                            </div> 
                            <hr></hr>                           
                            <div class="notranslate details-property">` + property_element + `</div>
                        </div>
                    </div>`
        }

        function showProductForm(params) {
            var brand = params.brand
            var category = params.category
            var product = params.product
            var barcode = params.barcode
            var price = params.price
            var currency = params.currency
            var description = params.description
            var colors = params.colors
            var discount = params.discount
            var period = params.period
            var stock = params.stock
            var percentage = ''
            var image = params.image
            var element = ''
            var isStock = ''

            var width = params.width
            var height = params.height
            var weight = params.weight
            var depth = params.depth
            var material = params.material

            if (currency == 'KHR') {
                currency_element = `<option value="USD"><span>&#36;</span></option>
                                    <option value="KHR" selected="selected"><span>\u17DB</span></option>`
            } else {
                currency_element = `<option value="USD" selected="selected"><span>&#36;</span></option>
                                    <option value="KHR""><span>\u17DB</span></option>`
            }

            if (stock) {
                isStock += 'checked="checked"'
            }

            if (period == null) {
                period = ''
            }

            if (discount == '') {
                percentage = '<span class="percentage hide">%</span>'
            } else {
                percentage = '<span class="percentage">%</span>'
            }

            if (colors.length > 0) {
                colors.forEach(color => {
                    /*color change*/
                    element += '<option value="' + color.hex + '" id="' + color.id + '">' + color.color +
                        '</option>'
                });
            }
            if (category != '') {

            }
            var productForm =
                `<h5 class="color-font m-0 ln-product">Product</h5>
                    <div class="slide-form" style="width: 100%;">
                        <form action="/product/add" method="post" enctype="multipart/form-data" style="width: 100%;" id="product-form">
                            <h5 class="color-font sub-content"><i class="fa fa-caret-right right" aria-hidden="true"></i><span class="ln-select-cate">Select Category</span></h5>
                            <input type="hidden" name="brand" id="brand-id">
                            <div class="form-group selector mt-1">
                                <p class="detail-content ln-category-details">Use category for specific products</p>
                                <select name="category" id="category" class="form-control input-color notranslate" required>
                                    <option disabled="disabled" selected="selected" value="">Select category</option>
                                    {% if categories %}
                                    {% for category in categories %}
                                    <option value="{{category.id}}">{{category.category}}</option>
                                    {% endfor %}
                                    {% else %}
                                    <option value="" disabled="disabled">No category</option>
                                    {% endif %}
                                </select>
                            </div>
                            <div class="form-group selector pt-2">
                                <p class="detail-content ln-brand-details">Select brand for specific products</p>
                                <select name="brand" id="select-brands" class="form-control input-color notranslate" required>
                                    <option disabled="disabled" selected="selected" value="">Select brand</option>
                                </select>
                            </div>

                            <h5 class="color-font sub-content mb-2"><i class="fa fa-caret-right right" aria-hidden="true"></i><span class="ln-product-info">Product
                                Informations</span></h5>
                           
                            <div class="form-group">
                                <input type="text" class="form-control input-color" name="product" id="product" value="` + product + `" required>
                                <label for="product" class="label product ln-product">Product</label>

                                <div class="checkbox-container">
                                    <label for="is-stock" class="is-stock" title="tick this box if it contain stock" data-toggle="tooltip" data-placement="bottom">
                                        <input type="checkbox" id="is-stock" name="is-stock" `+ isStock + ` value="true">
                                        <span class="check-span"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <input type="number" step="any" class="form-control input-color" name="price" id="price" value="` + price +
                `" required>
                                        <label for="price" class="label price ln-price">Price</label>
                                    </div>
                                </div>
                                <div class="col-md-4 selector pl-0">
                                    <div class="form-group">
                                        <select name="currency" id="currency" class="form-control input-color">
                                            `+currency_element+`
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-5 pr-0" style="position: relative">
                                    `+ percentage + `
                                    <div class="form-group">
                                        <input type="number" min="0" max="100" class="form-control input-color" name="discount" id="discount"
                                            value="` + discount +
                `" required>
                                        <label for="discount" class="label discount text-wrapper ln-discount">Discount</label>
                                    </div>
                                </div>
                                <div class="col-md-7 selector">
                                    <div class="form-group date-field">
                                        <input type="date" class="form-control input-color" name="period" id="period" value="` + period + `">
                                        <label for="period" class="label period ln-period">Period</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control input-color" name="barcode" id="barcode" value="` + barcode + `" required>
                                <label for="barcode" class="label barcode ln-barcode">Barcode</label>
                                
                                <button type="button" class="is-scan" title="click the input fill and scan barcode" data-toggle="tooltip" data-placement="bottom">
                                    <ion-icon name="scan-outline"></ion-icon>
                                </button>
                            </div>
                            <div class="form-group">
                                <textarea name="details" id="details" class="form-control input-color textarea"
                                    required>` + description + `</textarea>
                                <label for="details" class="label details ln-description">Description</label>
                            </div>
                        </form>
                        
                        <div class="product-image hide">
                            <h5 class="color-font sub-content"><i class="fa fa-caret-right right" aria-hidden="true"></i><span class="ln-product-app">Product Appearance</span></h5>
                            <div class="form-group">
                                <p class="detail-content ln-photo-details">Select product photo</p>
                                <div class="upload-container">
                                    <div class="image-containers" id="product-img">
                                        <div class="image-item">
                                            <img src="` + image + `" id="product-src">
                                        </div>
                                    </div>
                                    <div class="bubbling hide">
                                        <img src="/static/svg/bubbling-{{current_user.theme}}.svg">
                                    </div>
                                    <label for="product-photo" class="upload-label">
                                        <input type="file" name="product-photo" id="product-photo" class="upload-input">
                                        <span><i class="fa fa-camera" aria-hidden="true"></i></span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group selector">
                                <p class="detail-content ln-color-details">Add color for product</p>
                                <div class="row notranslate">
                                    <div class="col-sm-2">
                                        <button class="btn input-color edit-color"></button>
                                    </div>
                                    <div class="col-sm-7 p-0 selector">
                                        <select name="color" id="color" class="form-control input-color" required>
                                            <option disabled selected="selected" value="">Select color</option>
                                            ` + element + `
                                        </select>   
                                    </div>
                                    <div class="col-sm-3">
                                        <button class="btn pickr input-color">+</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <p class="detail-content ln-color-photo-details">Select color photo: <span class="selected-color"></span></p>
                                <div class="upload-container">
                                    <div class="image-containers" id="color-img">
                                        <div class="image-item">
                                            <img src="/static/uploads/default.png" id="image-src">
                                        </div>
                                    </div>
                                    <div class="bubbling hide">
                                        <img src="/static/svg/bubbling-{{current_user.theme}}.svg">
                                    </div>
                                    <label for="photo" class="upload-label disabled">
                                        <input type="file" name="photo" id="photo" class="upload-input" multiple disabled>
                                        <span><i class="fa fa-camera" aria-hidden="true"></i></span>
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <input type="text" class="form-control input-color" name="width" id="width" value="` + width +
                `">
                                        <label for="width" class="label width ln-width">Width</label>
                                    </div>
                                </div>
                                <div class="col-md-4 selector pl-0">
                                    <div class="form-group">
                                        <input type="text" class="form-control input-color" name="height" id="height" value="` + height +
                `">
                                        <label for="height" class="label height ln-height">Height</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <input type="text" class="form-control input-color" name="weight" id="weight" value="` + weight +
                `">
                                        <label for="weight" class="label height ln-weight">Weight</label>
                                    </div>
                                </div>
                                <div class="col-md-4 selector pl-0">
                                    <div class="form-group">
                                        <input type="text" class="form-control input-color" name="depth" id="depth" value="` + depth +
                `">
                                        <label for="depth" class="label depth ln-depth">Depth</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                    <input type="text" class="form-control input-color" name="material" id="material" value="` + material +
                `">
                                    <label for="material" class="label material ln-material">Material</label>
                                </div>
                        </div>
                    </div>
                    <button class="btn btn-block border color-font submit-product ln-create">Create</button>
                    <button class="btn btn-block border color-font save-product hide ln-save">Save</button>`
            return productForm
        }

        function uuid() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0,
                    v = c == 'x' ? r : (r & 0x3 | 0x8)
                return v.toString(16)
            })
        }

        function uploadFile(files, self, url, callback) {

            const validtypes = ['image/gif', 'image/jpeg', 'image/png']
            this.url = url
            this.files = files
            this.self = self

            var id = $(this.self).parent().parent().parent().attr('id')
            var loader = $(this.self).parent().parent().parent().find('.bubbling')

            var form = new FormData()

            var len = []

            if (this.files.length > 0) {
                this.files.forEach((file, index) => {
                    if (jQuery.inArray(file.type, validtypes) == -1) {
                        callback('File type is not valid', loader)
                    } else {
                        if (file.size > 2000000) {
                            callback('File exceed the max size', loader)
                        } else {
                            form.append(index, file)
                            len.push(index)
                        }
                    }
                })
                if (len.length > 0) {
                    $.ajax({
                        url: this.url,
                        type: 'post',
                        data: form,
                        contentType: false,
                        cache: false,
                        processData: false,
                        beforeSend: function () {
                            toggleLoader(loader)
                        },
                        success: function (data) {
                            setTimeout(function () {
                                callback('Success', data)
                                toggleLoader(loader)
                            }, 1000)
                        }
                    })
                } else {
                    callback('', loader)
                }
            } else {
                callback('No file selected', loader)
            }

        }

        function uploadPhoto(files, color, product, self, url) {

            const validtypes = ['image/gif', 'image/jpeg', 'image/png']
            this.color = color
            this.product = product
            this.url = url
            this.files = files
            this.self = self

            var imgtag = $(this.self).closest('.upload-container').find('.image-containers').attr('id')
            var name = $(this.self).closest('.slide-form').find('#product').val()
            var loader = $(this.self).closest('.upload-container').find('.bubbling')


            toggleLoader(loader)
            var form = new FormData()
            form.append('color', this.color)
            form.append('name', name)

            var len = []

            if (this.files.length > 0) {
                this.files.forEach((file, index) => {
                    if (jQuery.inArray(file.type, validtypes) == -1) {
                        alert(languagesAlert[language].invalidFile)
                    } else {
                        if (file.size > 2000000) {
                            alert(languagesAlert[language].invalidSize)
                        } else {
                            form.append(index, file)
                            len.push(index)
                        }
                    }
                })
                if (len.length > 0) {
                    $.ajax({
                        url: this.url + '/' + this.product,
                        type: 'post',
                        data: form,
                        contentType: false,
                        cache: false,
                        processData: false,
                        beforeSend: function () {

                        },
                        success: function (data) {

                            setTimeout(function () {
                                if (this.url == '/product/photo') {
                                    $('.details-img').html(
                                        '<img src="/static/uploads/' + data[0]
                                            .src + '" alt="' + data[0].alt + '">')
                                    var element = `<div class="image-item">
                                            <img src="/static/uploads/` + data[0].src + `" alt="` + data[0]
                                            .alt + `">
                                        </div>`
                                    $('#' + imgtag).html(element)
                                } else {
                                    $('#' + imgtag).html(showColorPhotos(data
                                        .photos, 'color-images'))
                                }
                                toggleLoader(loader)
                            }, 1000)
                        }
                    })
                } else {
                    toggleLoader(loader)
                }
            } else {
                alert(languagesAlert[language].noFile)
                toggleLoader(loader)
            }

        }

        $(document).on('click', '.add-value', function () {
            var property = $(this).attr('id')
            var title = $(this).prev().text()
            $('.modal-title').text(title)
            $('.modal-body').html(valueForm('', '0.00', '', ''))
            toggleEdit($('.save-btn'), $('.edit-btn'))
            $('.save-btn').attr('id', property)
        })

        $('.save-btn').on('click', function () {
            event.stopPropagation()
            var product = $('.details-title').attr('id')
            var property = $(this).attr('id')

            var value = $('#property-name').val()
            var price = $('#property-price').val()
            var currency = $('#property-currency').val()
            var description = $('#property-description').val()

            if (value == '') {
                $('#property-name').focus()
            } else {
                $.ajax({
                    url: '/value/add',
                    method: 'POST',
                    data: {
                        product: product,
                        property: property,
                        value: value,
                        price: price,
                        currency: currency,
                        description: description
                    },
                    success: function (data) {
                        $('#addValue').modal('hide')
                        if (data.currency == 'KHR') {
                            currencyValue = '\u17DB'
                            precision = 0
                        } else {
                            currencyValue = '$'
                            precision = 3
                        }
                        var element = `<label class="value container-input" id="` + data.id + `">
                                        <div class="product-btn color-text">
                                            <i class="fa fa-pencil-square-o edit-value" aria-hidden="true"></i>
                                            <i class="fa fa-trash-o delete-value" aria-hidden="true"></i>
                                        </div>
                                        <div class="flex-between-start">
                                            <div class="flex-column-start-start">
                                                <h5 class="color-font" id="value-value">` + data.value +
                            `</h5>
                                                <p style="font-size: 11px" class="color-text" id="value-description">` + data.description + `</p>
                                            </div>
                                        </div>
                                        <div class="flex-end color-text" style="font-size: 18px">
                                            <p class="color-text hide" id="value-currency">` + data.currency + `</p>
                                            <p class="color-text" id="value-price">` + accounting.formatMoney(data.price, {
                                                                                                            precision: precision,
                                                                                                            format: {
                                                                                                                pos: "%v"+currencyValue,
                                                                                                                neg: "-%v"+currencyValue,
                                                                                                                zero: '...'
                                                                                                            }
                                                                                                        }) + `</p>
                                        </div>
                                        <input type="radio" name="` + data.property + `">
                                        <span class="checkbox"></span></label>`

                        var values = $('.property-' + data.property)
                        values.append(element)
                    }
                })
            }
        })
        $(document).on('click', '.btn-value', function () {
            $(this).parent().prev().find('.add-value').click()
        })

        function showColorPhotos(data, carousel) {
            this.data = data
            this.carousel = carousel
            var element = '<div id="' + this.carousel + '" class="carousel slide" data-ride="carousel">'
            var indicators = '<ul class="carousel-indicators">'
            var images = '<div class="carousel-inner">'
            if (this.data.length > 1) {
                this.data.forEach((photo, i) => {
                    if (i == 0) {
                        indicators += '<li class="active" data-target="#' + this.carousel +
                            '" data-slide-to="' + i + '"></li>'
                        images += `<div class="carousel-item active" id="` + photo.id + `">
                                    <a href="/static/uploads/` + photo.src + `" data-lightbox="` + photo.alt + `" data-title="` + photo.alt + `">
                                        <img src="/static/uploads/` + photo.src + `" alt="` + photo.alt + `">
                                    </a>
                                </div>`
                    } else {
                        indicators += '<li data-target="#' + this.carousel + '" data-slide-to="' + i + '"></li>'
                        images += `<div class="carousel-item" id="` + photo.id + `">
                                    <a href="/static/uploads/` + photo.src + `" data-lightbox="` + photo.alt + `" data-title="` + photo.alt + `">
                                        <img src="/static/uploads/` + photo.src + `" alt="` + photo.alt + `">
                                    </a>
                                </div>`
                    }
                    element += `<a class="carousel-control-prev" href="#` + this.carousel + `" data-slide="prev">
                                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                                </a>
                                <a class="carousel-control-next" href="#` + this.carousel + `" data-slide="next">
                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                </a>`
                })
            } else {
                if (this.data.length) {
                    images += `<div class="carousel-item active" id="` + data[0].id + `">
                                    <a href="/static/uploads/` + this.data[0].src + `" data-lightbox="` + this.data[0].alt + `" data-title="` + this.data[0].alt + `">
                                        <img src="/static/uploads/` + this.data[0].src + `" alt="` + this.data[0].alt + `">
                                    </a>
                                </div>`
                } else {
                    images += `<div class="carousel-item active">
                                <img src="/static/uploads/default.png" alt="No photo">
                            </div>`
                }
            }
            indicators += '</ul>'
            images += '</div>'
            element += indicators + images + `</div>`
            return element
        }

        function productConfiguration(params) {
            var image = params.image
            var colors = params.colors
            var product = params.product
            var category = params.category
            var description = params.description
            var currency = params.currency
            var price = params.price
            var properties = params.properties
            var values = params.values
            var id = params.id
            var stocks = params.stocks

            var configuration_element = ''

            var color_element = ''

            if (colors.length > 0) {
                color_element = `<h5 class="color-font" style="text-align: start">
                                    <i class="fa fa-caret-right right" aria-hidden="true"></i>Color
                                </h5><div class="details-colors">`
                colors.forEach(color => {
                    var quantity = 0
                    stocks.forEach(stock => {
                        if (stock.color == color.id) {
                            quantity += stock.quantity
                        }
                    })
                    color_element += `<div class="span-border color-text">
                                <span class="span-color" id="` + color.id + `" style="background-color: ` + color.hex + `" title="` + color.color + `"></span><div class="flex-between-end" style="width: 100%"><p>` + color.color + `</p><p>` + quantity + `</p></div>
                            </div>`
                });
                color_element += '</div>'
            }

            var property_element = ''

            if (properties.length > 0) {
                var propertyArr = []
                properties.forEach(property => {
                    var value_element = ''

                    if (values.length > 0) {
                        var isSeleted = false
                        var propertyObj = {}
                        values.forEach(value => {
                            var precision = 0
                            if (value.price % 1 != 0) {
                                precision = 3
                            }
                            var selected = ''
                            var option = accounting.formatMoney(value.price, {
                                precision: precision,
                                format: {
                                    pos: "+%s%v",
                                    neg: "-%s%v",
                                    zero: '<ion-icon class="value-active" name="checkmark-done-outline"></ion-icon>'
                                }
                            })

                            if (value.property == property.id) {
                                if (accounting.unformat(value.price) == 0 && isSeleted == false) {
                                    isSeleted = true
                                    selected = 'checked'
                                    propertyObj['id'] = property.id
                                    propertyObj['name'] = property.property
                                    propertyObj['value'] = value.value
                                    propertyObj['price'] = value.price
                                    propertyObj['description'] = value.description

                                    configuration_element += `<div class="config-list flex-between" id="` + property.id + `">
                                                                <p class="property-name color-text" style="font-size: 13px">`+ property.property + `: <span class="color-font value-description">` + value.description.toLowerCase() + ' ' + value.value.toLowerCase() + `</span></p>
                                                            </div>`
                                }

                                value_element += `<label class="value container-input" id="` + value.id + `">
                                                    <div class="flex-between-start">
                                                        <div class="flex-column-start-start">
                                                            <h5 class="color-font notranslate" id="value-value">` + value.value + `</h5>
                                                            <p style="font-size: 11px" class="color-text" id="value-description">` + value.description + `</p>
                                                        </div>
                                                    </div>
                                                    <input type="radio" class="input-radio" name="`+ property.property.toLowerCase().split(' ').join('-') + `" id="` + property.id + `" ` + selected + ` value="` + value.id + `">
                                                    <div class="flex-end notranslate color-text" style="font-size: 18px;" id="value-price">
                                                        ` + option + `
                                                    </div>
                                                    <span class="hide checkbox"></span>
                                                </label>`
                            }
                        })
                        propertyArr.push(propertyObj)
                    } else {
                        value_element = '<button class="btn border btn-value color-font" disabled>...</button>'
                    }
                    property_element +=
                        `<div class="flex-column-start-start mt-4">
                            <h5 class="color-font mb-3"><i class="fa fa-caret-right right" aria-hidden="true"></i>` +
                        property.property + `</h5>
                        </div>
                        <div class="property-values" id="` + property.property.split(' ').join('-') + '_' + property.id + `">
                            ` + value_element + `
                        </div>`
                });
            }


            return `<div class="modal-header">
                    <div class="details-details">
                        <div class="details">
                            <p class="notranslate color-font text-wrapper details-title" id="` + id +
                `" style="font-size: 23px;">` + product + `</p>
                            <div class="flex-start">
                                <p class="notranslate color-text" id="details-category" style="font-size: 12px;">` + category + `</p>
                                <div class="flex-start ml-1 description-container" style="width: 80%">
                                    <span class="caret-right"></span>
                                    <p class="color-text text-wrapper" id="details-description"
                                        style="font-size: 12px; text-align: left;">` + description + `
                                    <p>
                                </div>
                            </div>
                        </div>
                        <div class="details-header" style="font-size: 23px">
                            <span class="notranslate details-price color-font">` + accountUSD(price) + `</span>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <span class="color-font alert-btn"><ion-icon name="alert-circle-outline"></ion-icon></span>
                    <div class="modal-wrapper">
                        <div class="product-details">
                            <div class="details-left">
                                <div class="details-img">
                                    <img src="` + image + `" alt="" srcset="">
                                </div>
                                <h5 class="color-text mt-4" style="text-align: start;"><i class="fa fa-caret-right right" aria-hidden="true"></i>
                                    <span class="ln-configuration">Configuration</span></h5>
                                <div class="details-appearance notranslate">
                                    `+ configuration_element + `
                                </div>
                            </div>
                            <div class="details-right">
                                ` + color_element + `
                                <div class="notranslate details-property">` + property_element + `</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn color-font close-modal ln-cancel" data-dismiss="modal">Cancel</button>
                    <button class="btn border continue-btn color-font ln-continue">Continue</button>
                </div>`
        }

        function generateString(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }

        function roundUp(num, precision) {
            precision = Math.pow(10, precision)
            return Math.ceil(num * precision) / precision
        }

        $('.sidenav-btn').on('click', function () {
            $('.side-nav').addClass('active')
        })

        $('.close-sidenav').on('click', function () {
            $('.side-nav').removeClass('active')
        })

    </script>
    {% block script %} {% endblock %}
</body>

</html>